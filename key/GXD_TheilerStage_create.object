#!/bin/sh

#
# History
#
# 01/07/2016    lec 
#       - TR12223/converting _structure_key -> _emapa_term_key/_stage_key
#

cd `dirname $0` && . ./Configuration


cat - <<EOSQL | ${PG_DBUTILS}/bin/doisql.csh $0

ALTER TABLE mgd.GXD_TheilerStage ADD PRIMARY KEY (_Stage_key);

ALTER TABLE mgd.GXD_GelLaneStructure ADD FOREIGN KEY (_Stage_key) REFERENCES mgd.GXD_TheilerStage DEFERRABLE;

ALTER TABLE mgd.GXD_ISResultStructure ADD FOREIGN KEY (_Stage_key) REFERENCES mgd.GXD_TheilerStage DEFERRABLE;

ALTER TABLE mgd.VOC_Term_EMAPA ADD FOREIGN KEY (startStage) REFERENCES mgd.GXD_TheilerStage DEFERRABLE;

ALTER TABLE mgd.VOC_Term_EMAPA ADD FOREIGN KEY (endStage) REFERENCES mgd.GXD_TheilerStage DEFERRABLE;

ALTER TABLE mgd.VOC_Term_EMAPS ADD FOREIGN KEY (_Stage_key) REFERENCES mgd.GXD_TheilerStage DEFERRABLE;

ALTER TABLE mgd.ALL_Cre_Cache ADD FOREIGN KEY (_Stage_key) REFERENCES mgd.GXD_TheilerStage ON DELETE CASCADE DEFERRABLE;

ALTER TABLE mgd.GXD_Expression ADD FOREIGN KEY (_Stage_key) REFERENCES mgd.GXD_TheilerStage ON DELETE CASCADE DEFERRABLE;

EOSQL

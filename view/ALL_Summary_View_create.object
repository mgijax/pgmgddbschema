#!/bin/sh

#
# History
#
# 1. mpAnnots = null, disesase annotations = not null
# 2. mpAnnots = null, disesase annotations = null
# 3. mpAnnots = 'has data', disesase annotations = not null
# 4. mpAnnots = 'has data', disesase annotations = null
# 5. mpAnnots = 'no abnormal phenotype observed', disesase annotations = not null
# 6. mpAnnots = 'no abnormal phenotype observed', disesase annotations = null
#
# select * from ALL_SummaryByReference_View where jnumid = 'J:64364'
#

cd `dirname $0` && . ./Configuration

${PG_MGD_DBSCHEMADIR}/view/ALL_SummaryByReference_View_drop.object

cat - <<EOSQL | ${PG_DBUTILS}/bin/doisql.csh $0

create view mgd.ALL_SummaryByReference_View
as
WITH refs AS (
select distinct r._object_key, c.jnumid
from mgi_reference_assoc r, bib_citation_cache c
where c._refs_key = r._refs_key
and r._mgitype_key = 11
)
select r.jnumid, a.*
from refs r, all_summarybymarker_view a
where r._object_key = a._allele_key
;

EOSQL

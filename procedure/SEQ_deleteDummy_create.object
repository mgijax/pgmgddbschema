#!/bin/csh -f

#
# History
#
# 01/14/2004
#	- JSAM
#

cd `dirname $0` && source ./Configuration

cat - <<EOSQL | ${MGI_DBUTILS}/bin/doisql.csh ${DBSERVER} ${DBNAME} $0

use ${DBNAME}
go

create procedure SEQ_deleteDummy
  @seqKey integer
as

begin transaction

if (select v.term
	from SEQ_Sequence_Acc_View a, SEQ_Sequence s, VOC_Term v
	where a._Object_key = @seqKey
	and a._Object_key = s._Sequence_key
	and s._SequenceStatus_key = v._Term_key
	and v._Vocab_key = 20) != "Not Loaded"
begin
	raiserror 99999 "Cannot delete a non-Dummy Sequence"
	rollback transaction
	return
end

delete from SEQ_Sequence_Raw where _Sequence_key = @seqKey
delete from SEQ_Sequence where _Sequence_key = @seqKey

if @@error != 0
begin
	raiserror 99999 "Could not delete Sequence in SEQ_deleteDummy"
	rollback transaction
	return
end

commit transaction

go

quit

EOSQL

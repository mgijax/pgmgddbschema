#!/bin/sh

#
# History
#
# 11/16/2005	lec
#	- TR 7194; ALL_Knockout_Cache
#

cd `dirname $0` && . ./Configuration

cat - <<EOSQL | ${PG_DBUTILS}/bin/doisql.csh $0

DROP FUNCTION ALL_mergeAllele();

CREATE OR REPLACE FUNCTION ALL_mergeAllele (
  oldAlleleKey int,
  newAlleleKey int
)
RETURNS VOID AS
\$\$

DECLARE


BEGIN

update ALL_Knockout_Cache set _Allele_key = newAlleleKey where _Allele_key = oldAlleleKey
;

update GXD_AlleleGenotype set _Allele_key = newAlleleKey where _Allele_key = oldAlleleKey
;

update GXD_AllelePair set _Allele_key_1 = newAlleleKey where _Allele_key_1 = oldAlleleKey
;

update GXD_AllelePair set _Allele_key_2 = newAlleleKey where _Allele_key_2 = oldAlleleKey
;

update MLD_Expt_Marker set _Allele_key = newAlleleKey where _Allele_key = oldAlleleKey
;

delete from ALL_Allele where _Allele_key = oldAlleleKey
;




END;
\$\$
LANGUAGE plpgsql;

GRANT EXECUTE ON FUNCTION ALL_mergeAllele(int,int) TO public;

EOSQL

#!/bin/sh
#
# History
#
# 08/25/2014	lec
#	- TR11654/stored procedures for postgres
#
# 12/09/2004	lec
#	- TR 5686
#
cd `dirname $0` && . ./Configuration
cat - <<EOSQL | ${PG_DBUTILS}/bin/doisql.csh $0

DROP FUNCTION MGI_insertSynonym(int,int,int,varchar,int);

CREATE OR REPLACE FUNCTION MGI_insertSynonym (
v_objectKey int,
v_mgiTypeKey int,
v_synTypeKey int,
v_synonym varchar(255),
v_refsKey int = null
)
RETURNS VOID AS
\$\$

DECLARE
v_userKey int;
v_synKey int;


BEGIN

/* Insert new MGI_Synonym record */
select into v_userKey _User_key from MGI_User where login = current_user
;

select into v_synKey max(_Synonym_key + 1) from MGI_Synonym
;

if v_synKey is null
then
	select into v_synKey 1000
	;

/* Don't add duplicate entries */
end if;

if not exists (select 1 from MGI_Synonym
where _Object_key = v_objectKey
and _MGIType_key = v_mgiTypeKey
and _SynonymType_key = v_synTypeKey
and synonym = v_synonym)
then
	insert into MGI_Synonym
	(_Synonym_key, _Object_key, _MGIType_key, _SynonymType_key, _Refs_key, synonym, _CreatedBy_key, _ModifiedBy_key)
	values (v_synKey, v_objectKey, v_mgiTypeKey, v_synTypeKey, v_refsKey, v_synonym, v_userKey, v_userKey)
	;

end if;


END;
\$\$
LANGUAGE plpgsql;

GRANT EXECUTE ON FUNCTION MGI_insertSynonym(int,int,int,varchar,int) TO public;

EOSQL

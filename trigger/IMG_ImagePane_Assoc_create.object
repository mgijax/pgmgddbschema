#!/bin/csh -f

#
# History
#
# 06/14/2005	lec
#	 - TR 3557
#
#

cd `dirname $0` && source ./Configuration

cat - <<EOSQL | ${MGI_DBUTILS}/bin/doisql.csh ${DBSERVER} ${DBNAME} $0

use ${DBNAME}
go

create trigger IMG_ImagePane_Assoc_Delete
on IMG_ImagePane_Assoc
for delete
as

delete MGI_Reference_Assoc from MGI_Reference_Assoc, deleted
where MGI_Reference_Assoc._MGIType_key = 29
and MGI_Reference_Assoc._Object_key = deleted._Assoc_key

delete MGI_Note from MGI_Note, deleted
where MGI_Note._MGIType_key = 29
and MGI_Note._Object_key = deleted._Assoc_key

/* delete any cached image entries for this association */
delete IMG_Cache
from IMG_Cache ic, deleted d
where ic._Object_key = d._Object_key
and ic._MGIType_key = d._MGIType_key
and ic._ImagePane_key = d._ImagePane_key

go

checkpoint
go

quit

EOSQL

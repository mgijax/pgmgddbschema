#!/bin/csh -f -x

#
# History
#	10/23/2007 - jsb - added for Home Page project (MGI 4.0), TR 8087
#

cd `dirname $0` && source ./Configuration

cat - <<EOSQL | ${MGI_DBUTILS}/bin/doisql.csh ${DBSERVER} ${DBNAME} $0

use ${DBNAME}
go

create trigger MGI_Statistic_Delete
on MGI_Statistic
for delete
as

/* delete corresponding rows from related tables */

delete MGI_StatisticSql
from MGI_StatisticSql, deleted
where MGI_StatisticSql._Statistic_key = deleted._Statistic_key

delete MGI_Measurement
from MGI_Measurement, deleted
where MGI_Measurement._Statistic_key = deleted._Statistic_key

/* delete this statistic from any sets which contain it */

delete MGI_SetMember
from MGI_SetMember msm, deleted d, MGI_Set ms
where msm._Object_key = d._Statistic_key
	and msm._Set_key = ms._Set_key
	and ms._MGIType_key = 34
go

checkpoint
go

quit

EOSQL
